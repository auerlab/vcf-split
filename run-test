#!/bin/sh -e

##########################################################################
#   Script description:
#       
#   History:
#   Date        Name        Modification
#   2019-12-08  Jason Bacon Begin
##########################################################################

usage()
{
    printf "Usage: $0 multisample-VCF/BCF-file prefix-for-output-files\n"
    printf "Example: $0 freeze.8.chr1.pass_only.phased.bcf chr1.\n"
    exit 1
}


##########################################################################
#   Main
##########################################################################

if [ $# != 0 ]; then
    usage
fi

# Filtering out calls with no het sites is probably useless with 137k
# samples per call.
# Does not seem to work in conjunction with --samples.
# --samples NWDXXXX --genotype het produces lines with 1|1 or 0|0.
# Maybe checking all samples for het instead of desired samples?
#
# vcftools is much slower than bcftools

# From bcf-bench:
# --min-ac + --genotype about double run time
# --min-ax + --samples increases run time by order of magnitude

input="$1"
prefix="$2"
set -x
#time bcftools view --min-ac 2 --exclude-types indels \
#    ../phased/freeze.8.chr1.pass_only.phased.bcf \
#    | ./vcf-split --max-calls 100000 chr1. 11495 11495
#exit

time bcftools view --min-ac 2 --exclude-types indels \
    ../phased/freeze.8.chr1.pass_only.phased.bcf \
    | ./vcf-split --sample-id-file LLS_WHIMS_NWDID_TOPMED.csv \
    --max-calls 100000 chr1. 1 10000
